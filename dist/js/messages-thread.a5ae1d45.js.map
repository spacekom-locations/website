{"version":3,"file":"js/messages-thread.a5ae1d45.js","mappings":"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","sources":["webpack://website/./src/api/messages/index.js","webpack://website/./node_modules/uuid/dist/esm-browser/rng.js","webpack://website/./node_modules/uuid/dist/esm-browser/regex.js","webpack://website/./node_modules/uuid/dist/esm-browser/validate.js","webpack://website/./node_modules/uuid/dist/esm-browser/stringify.js","webpack://website/./node_modules/uuid/dist/esm-browser/v4.js","webpack://website/./src/views/messages/ui/MessagesView.vue?d296","webpack://website/src/views/messages/ui/MessagesView.vue","webpack://website/./src/views/messages/ui/MessagesView.vue?afe4","webpack://website/./src/views/messages/ui/MessagesView.vue"],"sourcesContent":["import api from \"../index\";\n\nexport const loadThreads = async function () {\n  const response = await api.get(\"/messages\");\n  return response.data;\n};\n\nexport const createThread = async function (\n  message,\n  location_id,\n  booking_inputs,\n  has_flexible_dates\n) {\n  const response = await api.post(\"/messages\", {\n    message,\n    location_id,\n    booking_inputs,\n    has_flexible_dates,\n  });\n  return response.data;\n};\n\nexport const createThreadFromBooking = async function (bookingId, message) {\n  const response = await api.post(`/messages/compose-from-booking`, {\n    message: message,\n    booking_id: bookingId\n  });\n  return response.data;\n};\n\nexport const showThread = async function (id) {\n  const response = await api.get(`/messages/${id}`);\n  return response.data;\n};\n\nexport const sendMessage = async function (threadId, message) {\n  const response = await api.post(`messages/${threadId}`, {\n    message,\n  });\n  return response.data;\n};\n","// Unique ID creation requires a high quality random # generator. In the browser we therefore\n// require the crypto API and do not support built-in fallback to lower quality random number\n// generators (like Math.random()).\nvar getRandomValues;\nvar rnds8 = new Uint8Array(16);\nexport default function rng() {\n  // lazy load so that environments that need to polyfill have a chance to do so\n  if (!getRandomValues) {\n    // getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation. Also,\n    // find the complete implementation of crypto (msCrypto) on IE11.\n    getRandomValues = typeof crypto !== 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto) || typeof msCrypto !== 'undefined' && typeof msCrypto.getRandomValues === 'function' && msCrypto.getRandomValues.bind(msCrypto);\n\n    if (!getRandomValues) {\n      throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');\n    }\n  }\n\n  return getRandomValues(rnds8);\n}","export default /^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;","import REGEX from './regex.js';\n\nfunction validate(uuid) {\n  return typeof uuid === 'string' && REGEX.test(uuid);\n}\n\nexport default validate;","import validate from './validate.js';\n/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\n\nvar byteToHex = [];\n\nfor (var i = 0; i < 256; ++i) {\n  byteToHex.push((i + 0x100).toString(16).substr(1));\n}\n\nfunction stringify(arr) {\n  var offset = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n  // Note: Be careful editing this code!  It's been tuned for performance\n  // and works in ways you may not expect. See https://github.com/uuidjs/uuid/pull/434\n  var uuid = (byteToHex[arr[offset + 0]] + byteToHex[arr[offset + 1]] + byteToHex[arr[offset + 2]] + byteToHex[arr[offset + 3]] + '-' + byteToHex[arr[offset + 4]] + byteToHex[arr[offset + 5]] + '-' + byteToHex[arr[offset + 6]] + byteToHex[arr[offset + 7]] + '-' + byteToHex[arr[offset + 8]] + byteToHex[arr[offset + 9]] + '-' + byteToHex[arr[offset + 10]] + byteToHex[arr[offset + 11]] + byteToHex[arr[offset + 12]] + byteToHex[arr[offset + 13]] + byteToHex[arr[offset + 14]] + byteToHex[arr[offset + 15]]).toLowerCase(); // Consistency check for valid UUID.  If this throws, it's likely due to one\n  // of the following:\n  // - One or more input array values don't map to a hex octet (leading to\n  // \"undefined\" in the uuid)\n  // - Invalid input values for the RFC `version` or `variant` fields\n\n  if (!validate(uuid)) {\n    throw TypeError('Stringified UUID is invalid');\n  }\n\n  return uuid;\n}\n\nexport default stringify;","import rng from './rng.js';\nimport stringify from './stringify.js';\n\nfunction v4(options, buf, offset) {\n  options = options || {};\n  var rnds = options.random || (options.rng || rng)(); // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n\n  rnds[6] = rnds[6] & 0x0f | 0x40;\n  rnds[8] = rnds[8] & 0x3f | 0x80; // Copy bytes to buffer, if provided\n\n  if (buf) {\n    offset = offset || 0;\n\n    for (var i = 0; i < 16; ++i) {\n      buf[offset + i] = rnds[i];\n    }\n\n    return buf;\n  }\n\n  return stringify(rnds);\n}\n\nexport default v4;","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('v-container',{staticClass:\"ma-0 pa-0\",staticStyle:{\"height\":\"100%\",\"background-color\":\"#f8f8f8\"}},[_c('div',{staticClass:\"sticky-top\",staticStyle:{\"z-index\":\"2\"}},[_c('v-card',{staticStyle:{\"border-bottom\":\"1px solid #d2d2d2 !important\",\"border-radius\":\"0\"},attrs:{\"height\":\"70px\",\"flat\":\"\"}},[(!_vm.loading)?_c('v-card-text',[_c('p',{staticClass:\"subtitle-1 black--text py-0 my-0 font-weight-bold\"},[_vm._v(\" \"+_vm._s(_vm.getThreadUser() ? _vm.getThreadUser().name : \"\")+\" \")]),_c('p',{staticClass:\"caption\"},[_vm._v(\"Response Time: 1 day\")])]):_vm._e(),_c('div',{staticClass:\"pa-4\"},[(_vm.loading)?_c('v-progress-circular',{staticClass:\"mx-auto\",attrs:{\"indeterminate\":\"\",\"size\":\"32\",\"color\":\"success\",\"loading\":true}}):_vm._e()],1)],1)],1),_c('v-row',{staticClass:\"pb-4\",attrs:{\"id\":\"messages-container\",\"align\":\"end\"}},[(_vm.loading)?_c('div',{staticClass:\"d-flex justify-center my-2 pa-12 ma-0\",staticStyle:{\"width\":\"100%\"}},[_c('v-progress-circular',{staticClass:\"mx-auto\",attrs:{\"indeterminate\":\"\",\"size\":\"56\",\"color\":\"success\",\"loading\":true}})],1):_vm._e(),_c('v-col',[_c('v-container',{staticStyle:{\"max-width\":\"700px\"}},[_vm._l((_vm.sortedMessages),function(message,index){return _c('div',{key:((message.id) + \"_\" + (_vm.uuid())),class:[\n              'd-flex flex-row align-end my-2',\n              message.user_id == _vm.currentUser.id ? 'justify-end' : null ]},[(message.user_id == _vm.currentUser.id)?_c('v-card',{staticClass:\"black--text mr-3 rounded-lg pa-2\",style:(!_vm.sortedMessages[index + 1] ||\n                _vm.sortedMessages[index + 1].user_id != message.user_id\n                  ? 'border-bottom-right-radius: 0px !important'\n                  : ''),attrs:{\"max-width\":\"500px\",\"min-width\":\"100px\",\"color\":\"#4caf50CC\",\"flat\":\"\"}},[_c('v-card-text',{staticClass:\"white--text subtitle-1\"},[_c('p',[_c('span',{staticClass:\"subtitle-1 font-weight-bold\"},[_vm._v(_vm._s(_vm.currentUser.name))]),_c('span',{staticClass:\"mx-2\"}),_c('span',{staticClass:\"caption\"},[_vm._v(\" \"+_vm._s(_vm._f(\"timeFormat\")(message.updated_at))+\" \"),(_vm.isMessageReadByTheParticipant(message.updated_at))?_c('v-icon',{staticClass:\"mx-2\",attrs:{\"color\":\"white\",\"size\":\"20\"}},[_vm._v(\" mdi-check-all \")]):_vm._e()],1)]),_vm._v(\" \"+_vm._s(message.body)+\" \")])],1):_vm._e(),(\n                !_vm.sortedMessages[index + 1] ||\n                _vm.sortedMessages[index + 1].user_id != message.user_id\n              )?_c('user-avatar',{attrs:{\"image\":_vm.getParticipantById(message.user_id).avatar,\"size\":48}}):_c('user-avatar',{staticStyle:{\"opacity\":\"0\"},attrs:{\"size\":48}}),(message.user_id != _vm.currentUser.id)?_c('v-card',{staticClass:\"black--text ml-3 rounded-lg pa-2\",style:(!_vm.sortedMessages[index + 1] ||\n                _vm.sortedMessages[index + 1].user_id != message.user_id\n                  ? 'border-bottom-left-radius: 0px !important'\n                  : ''),attrs:{\"max-width\":\"500px\",\"min-width\":\"100px\",\"color\":\"#2196f3CC\",\"flat\":\"\"}},[_c('v-card-text',{staticClass:\"white--text subtitle-1\"},[_c('p',[_c('span',{staticClass:\"subtitle-1 font-weight-bold\"},[_vm._v(_vm._s(_vm.getParticipantById(message.user_id).name))]),_c('span',{staticClass:\"mx-2\"}),_c('span',{staticClass:\"caption\"},[_vm._v(\" \"+_vm._s(_vm._f(\"timeFormat\")(message.updated_at))+\" \")])]),_vm._v(\" \"+_vm._s(message.body)+\" \")])],1):_vm._e()],1)}),_vm._l((_vm.pendingMessages),function(message){return _c('div',{key:((message.body) + \"_\" + (_vm.uuid())),class:['d-flex flex-row align-center my-2 justify-end']},[_c('v-progress-circular',{staticClass:\"mx-4\",attrs:{\"color\":\"success\",\"size\":\"24\",\"indeterminate\":\"\"}}),_c('v-card',{staticClass:\"black--text mr-3 rounded-xl pa-2\",attrs:{\"max-width\":\"500px\",\"min-width\":\"100px\",\"color\":\"#4caf5066\",\"flat\":\"\"}},[_c('v-card-text',{staticClass:\"white--text subtitle-1\"},[_vm._v(\" \"+_vm._s(message.body)+\" \")])],1),_c('user-avatar',{attrs:{\"image\":_vm.currentUser.avatar,\"size\":48}})],1)})],2)],1)],1),_c('div',{staticClass:\"message-input-box\",staticStyle:{\"background-color\":\"#e4e4e455\"}},[_c('v-container',{staticClass:\"ma-0 pa-0 mx-auto\",staticStyle:{\"max-width\":\"700px\"}},[_c('v-row',{attrs:{\"no-gutters\":\"\"}},[_c('v-col',[_c('v-card',{staticStyle:{\"background-color\":\"transparent\"},attrs:{\"flat\":\"\"}},[_c('v-card-text',[_c('v-text-field',{staticStyle:{\"background-color\":\"white\"},attrs:{\"placeholder\":\"Type Something\",\"append-icon\":\"mdi-send\",\"outlined\":\"\",\"hide-details\":\"\"},on:{\"keyup\":function($event){if(!$event.type.indexOf('key')&&_vm._k($event.keyCode,\"enter\",13,$event.key,\"Enter\")){ return null; }return _vm.send.apply(null, arguments)},\"click:append\":_vm.send},model:{value:(_vm.msg),callback:function ($$v) {_vm.msg=$$v},expression:\"msg\"}})],1)],1)],1)],1)],1)],1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div>\n    <v-container\n      class=\"ma-0 pa-0\"\n      style=\"height: 100%; background-color: #f8f8f8\"\n    >\n      <div class=\"sticky-top\" style=\"z-index: 2\">\n        <v-card\n          class=\"\"\n          height=\"70px\"\n          style=\"border-bottom: 1px solid #d2d2d2 !important; border-radius: 0\"\n          flat\n        >\n          <v-card-text v-if=\"!loading\">\n            <p class=\"subtitle-1 black--text py-0 my-0 font-weight-bold\">\n              {{ getThreadUser() ? getThreadUser().name : \"\" }}\n            </p>\n            <p class=\"caption\">Response Time: 1 day</p>\n          </v-card-text>\n          <div class=\"pa-4\">\n            <v-progress-circular\n              v-if=\"loading\"\n              indeterminate\n              size=\"32\"\n              color=\"success\"\n              :loading=\"true\"\n              class=\"mx-auto\"\n            ></v-progress-circular>\n          </div>\n        </v-card>\n      </div>\n\n      <v-row id=\"messages-container\" class=\"pb-4\" align=\"end\">\n        <div\n          v-if=\"loading\"\n          style=\"width: 100%\"\n          class=\"d-flex justify-center my-2 pa-12 ma-0\"\n        >\n          <v-progress-circular\n            indeterminate\n            size=\"56\"\n            color=\"success\"\n            :loading=\"true\"\n            class=\"mx-auto\"\n          ></v-progress-circular>\n        </div>\n        <v-col>\n          <v-container style=\"max-width: 700px\">\n            <div\n              v-for=\"(message, index) of sortedMessages\"\n              :key=\"`${message.id}_${uuid()}`\"\n              :class=\"[\n                'd-flex flex-row align-end my-2',\n                message.user_id == currentUser.id ? 'justify-end' : null,\n              ]\"\n            >\n              <v-card\n                max-width=\"500px\"\n                min-width=\"100px\"\n                v-if=\"message.user_id == currentUser.id\"\n                class=\"black--text mr-3 rounded-lg pa-2\"\n                color=\"#4caf50CC\"\n                flat\n                :style=\"\n                  !sortedMessages[index + 1] ||\n                  sortedMessages[index + 1].user_id != message.user_id\n                    ? 'border-bottom-right-radius: 0px !important'\n                    : ''\n                \"\n              >\n                <v-card-text class=\"white--text subtitle-1\">\n                  <p>\n                    <span class=\"subtitle-1 font-weight-bold\">{{\n                      currentUser.name\n                    }}</span>\n                    <span class=\"mx-2\"></span>\n                    <span class=\"caption\">\n                      {{ message.updated_at | timeFormat }}\n                      <v-icon\n                        v-if=\"isMessageReadByTheParticipant(message.updated_at)\"\n                        color=\"white\"\n                        size=\"20\"\n                        class=\"mx-2\"\n                      >\n                        mdi-check-all\n                      </v-icon>\n                    </span>\n                  </p>\n                  {{ message.body }}\n                </v-card-text>\n              </v-card>\n\n              <user-avatar\n                :image=\"getParticipantById(message.user_id).avatar\"\n                v-if=\"\n                  !sortedMessages[index + 1] ||\n                  sortedMessages[index + 1].user_id != message.user_id\n                \"\n                :size=\"48\"\n              />\n              <user-avatar v-else :size=\"48\" style=\"opacity: 0\" />\n\n              <v-card\n                max-width=\"500px\"\n                min-width=\"100px\"\n                v-if=\"message.user_id != currentUser.id\"\n                class=\"black--text ml-3 rounded-lg pa-2\"\n                color=\"#2196f3CC\"\n                flat\n                :style=\"\n                  !sortedMessages[index + 1] ||\n                  sortedMessages[index + 1].user_id != message.user_id\n                    ? 'border-bottom-left-radius: 0px !important'\n                    : ''\n                \"\n              >\n                <v-card-text class=\"white--text subtitle-1\">\n                  <p>\n                    <span class=\"subtitle-1 font-weight-bold\">{{\n                      getParticipantById(message.user_id).name\n                    }}</span>\n                    <span class=\"mx-2\"></span>\n                    <span class=\"caption\">\n                      {{ message.updated_at | timeFormat }}\n                    </span>\n                  </p>\n                  {{ message.body }}\n                </v-card-text>\n              </v-card>\n            </div>\n            <div\n              v-for=\"message in pendingMessages\"\n              :key=\"`${message.body}_${uuid()}`\"\n              :class=\"['d-flex flex-row align-center my-2 justify-end']\"\n            >\n              <v-progress-circular\n                color=\"success\"\n                size=\"24\"\n                indeterminate\n                class=\"mx-4\"\n              ></v-progress-circular>\n              <v-card\n                max-width=\"500px\"\n                min-width=\"100px\"\n                class=\"black--text mr-3 rounded-xl pa-2\"\n                color=\"#4caf5066\"\n                flat\n              >\n                <v-card-text class=\"white--text subtitle-1\">\n                  {{ message.body }}\n                </v-card-text>\n              </v-card>\n              <user-avatar :image=\"currentUser.avatar\" :size=\"48\" />\n            </div>\n          </v-container>\n        </v-col>\n      </v-row>\n      <div class=\"message-input-box\" style=\"background-color: #e4e4e455\">\n        <v-container class=\"ma-0 pa-0 mx-auto\" style=\"max-width: 700px\">\n          <v-row no-gutters>\n            <v-col>\n              <v-card class=\"\" flat style=\"background-color: transparent\">\n                <v-card-text>\n                  <v-text-field\n                    v-model=\"msg\"\n                    placeholder=\"Type Something\"\n                    @keyup.enter=\"send\"\n                    append-icon=\"mdi-send\"\n                    @click:append=\"send\"\n                    outlined\n                    style=\"background-color: white\"\n                    hide-details\n                  ></v-text-field>\n                </v-card-text>\n              </v-card>\n            </v-col>\n          </v-row>\n        </v-container>\n      </div>\n    </v-container>\n  </div>\n</template>\n\n<script>\nimport { sendMessage, showThread } from \"@/api/messages\";\nimport UserAvatar from \"@/components/user/UserAvatar.vue\";\nimport { v4 as uuidv4 } from \"uuid\";\nimport moment from \"moment\";\nimport { mainEventBus } from \"@/main\";\n\nexport default {\n  components: { UserAvatar },\n  props: {},\n  data() {\n    return {\n      thread: {},\n      pendingMessages: [],\n      loading: false,\n      msg: null,\n    };\n  },\n  updated() {\n    this.scrollToEnd();\n  },\n  async created() {\n    await this.loadMessages();\n    mainEventBus.$on(\n      \"message-for-thread-\" + this.thread.id,\n      this.showNewMessage\n    );\n  },\n  computed: {\n    currentUser() {\n      return this.$store.getters[\"User/user\"];\n    },\n    sortedMessages() {\n      const messages = [...(this.thread.messages || [])];\n\n      messages.sort(\n        (objA, objB) =>\n          Number(new Date(objA.updated_at)) - Number(new Date(objB.updated_at))\n      );\n      return messages;\n    },\n  },\n  methods: {\n    showNewMessage(message) {\n      let messages = [...(this.thread.messages || [])];\n      messages.push(message);\n      this.getThreadParticipant().last_read = new Date();\n      this.thread.messages = [...messages];\n    },\n    isMessageReadByTheParticipant(messageDate) {\n      return moment(messageDate).isBefore(\n        this.getThreadParticipant().last_read\n      );\n    },\n    async loadMessages() {\n      this.loading = true;\n      const response = await showThread(this.$route.params.id);\n      this.thread = response.data;\n      this.loading = false;\n    },\n    scrollToEnd() {\n      var container = this.$el.querySelector(\"#messages-container\");\n      var scrollHeight = container.scrollHeight;\n      container.scrollTop = scrollHeight;\n    },\n    getParticipantById(id) {\n      for (let participant of this.thread.participants) {\n        if (participant.user_id == id) return participant.user;\n      }\n      return null;\n    },\n    async send() {\n      if (!this.msg || this.msg.trim() == \"\") return false;\n\n      const message = {\n        user_id: this.currentUser.id,\n        body: this.msg,\n      };\n      this.msg = null;\n      this.pendingMessages.push(message);\n      const response = await sendMessage(this.thread.id, message.body);\n      const messages = Object.assign([], this.thread.messages);\n      messages.push(response.data);\n\n      this.thread.messages = messages;\n      this.pendingMessages.splice(this.pendingMessages.indexOf(message), 1);\n    },\n\n    getThreadUser() {\n      return this.getThreadParticipant().user;\n    },\n    getThreadParticipant() {\n      if (!this.thread.participants) return {};\n      if (this.thread.participants[0].user_id == this.currentUser.id) {\n        return this.thread.participants[1];\n      }\n      return this.thread.participants[0];\n    },\n    uuid() {\n      return uuidv4();\n    },\n  },\n  watch: {\n    \"$route.params.id\"() {\n      this.thread = {};\n      this.loadMessages();\n    },\n  },\n};\n</script>\n\n<style scoped>\n#messages-container {\n  background-color: #e4e4e455;\n  min-height: calc(100vh - 225px);\n  width: 100%;\n  height: calc(100vh - 225px);\n  overflow: auto;\n  left: 20px;\n  margin: 0;\n  z-index: 0;\n}\n</style>","import mod from \"-!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40[0].rules[0].use[1]!../../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./MessagesView.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40[0].rules[0].use[1]!../../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./MessagesView.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./MessagesView.vue?vue&type=template&id=67ad5e19&scoped=true&\"\nimport script from \"./MessagesView.vue?vue&type=script&lang=js&\"\nexport * from \"./MessagesView.vue?vue&type=script&lang=js&\"\nimport style0 from \"./MessagesView.vue?vue&type=style&index=0&id=67ad5e19&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"67ad5e19\",\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VCard } from 'vuetify/lib/components/VCard';\nimport { VCardText } from 'vuetify/lib/components/VCard';\nimport { VCol } from 'vuetify/lib/components/VGrid';\nimport { VContainer } from 'vuetify/lib/components/VGrid';\nimport { VIcon } from 'vuetify/lib/components/VIcon';\nimport { VProgressCircular } from 'vuetify/lib/components/VProgressCircular';\nimport { VRow } from 'vuetify/lib/components/VGrid';\nimport { VTextField } from 'vuetify/lib/components/VTextField';\ninstallComponents(component, {VCard,VCardText,VCol,VContainer,VIcon,VProgressCircular,VRow,VTextField})\n"],"names":["loadThreads","async","response","api","data","createThread","message","location_id","booking_inputs","has_flexible_dates","createThreadFromBooking","bookingId","booking_id","showThread","id","sendMessage","threadId","getRandomValues","rnds8","Uint8Array","rng","crypto","bind","msCrypto","Error","validate","uuid","byteToHex","i","push","toString","substr","stringify","arr","offset","arguments","length","undefined","toLowerCase","TypeError","v4","options","buf","rnds","random","render","_vm","this","_h","$createElement","_c","_self","staticClass","staticStyle","attrs","loading","_e","_v","_s","getThreadUser","name","_l","index","key","class","user_id","currentUser","style","sortedMessages","_f","updated_at","isMessageReadByTheParticipant","body","getParticipantById","avatar","on","$event","type","indexOf","_k","keyCode","send","apply","model","value","callback","$$v","msg","expression","staticRenderFns","components","UserAvatar","props","thread","pendingMessages","updated","mainEventBus","computed","messages","Number","methods","showNewMessage","scrollToEnd","container","getThreadParticipant","watch","component","VCard"],"sourceRoot":""}