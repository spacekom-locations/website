"use strict";(self["webpackChunkwebsite"]=self["webpackChunkwebsite"]||[]).push([[640],{61747:function(t,e,r){r.d(e,{Io:function(){return u},MW:function(){return o},bG:function(){return c},gK:function(){return i},vW:function(){return n}});var a=r(16198),s=(r(35666),r(76051)),n=function(){var t=(0,a.Z)(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,s.ZP.get("/messages");case 2:return e=t.sent,t.abrupt("return",e.data);case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),i=function(){var t=(0,a.Z)(regeneratorRuntime.mark((function t(e,r,a,n){var i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,s.ZP.post("/messages",{message:e,location_id:r,booking_inputs:a,has_flexible_dates:n});case 2:return i=t.sent,t.abrupt("return",i.data);case 4:case"end":return t.stop()}}),t)})));return function(e,r,a,s){return t.apply(this,arguments)}}(),o=function(){var t=(0,a.Z)(regeneratorRuntime.mark((function t(e,r){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,s.ZP.post("/messages/compose-from-booking",{message:r,booking_id:e});case 2:return a=t.sent,t.abrupt("return",a.data);case 4:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}(),u=function(){var t=(0,a.Z)(regeneratorRuntime.mark((function t(e){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,s.ZP.get("/messages/".concat(e));case 2:return r=t.sent,t.abrupt("return",r.data);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),c=function(){var t=(0,a.Z)(regeneratorRuntime.mark((function t(e,r){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,s.ZP.post("messages/".concat(e),{message:r});case 2:return a=t.sent,t.abrupt("return",a.data);case 4:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}()},25934:function(t,e,r){var a;r.d(e,{Z:function(){return f}});var s=new Uint8Array(16);function n(){if(!a&&(a="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!==typeof msCrypto&&"function"===typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),!a))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return a(s)}var i=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function o(t){return"string"===typeof t&&i.test(t)}for(var u=o,c=[],d=0;d<256;++d)c.push((d+256).toString(16).substr(1));function l(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(c[t[e+0]]+c[t[e+1]]+c[t[e+2]]+c[t[e+3]]+"-"+c[t[e+4]]+c[t[e+5]]+"-"+c[t[e+6]]+c[t[e+7]]+"-"+c[t[e+8]]+c[t[e+9]]+"-"+c[t[e+10]]+c[t[e+11]]+c[t[e+12]]+c[t[e+13]]+c[t[e+14]]+c[t[e+15]]).toLowerCase();if(!u(r))throw TypeError("Stringified UUID is invalid");return r}var p=l;function g(t,e,r){t=t||{};var a=t.random||(t.rng||n)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,e){r=r||0;for(var s=0;s<16;++s)e[r+s]=a[s];return e}return p(a)}var f=g},38630:function(t,e,r){r.r(e),r.d(e,{default:function(){return T}});var a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("v-container",{staticClass:"ma-0 pa-0",staticStyle:{height:"100%","background-color":"#f8f8f8"}},[r("div",{staticClass:"sticky-top",staticStyle:{"z-index":"2"}},[r("v-card",{staticStyle:{"border-bottom":"1px solid #d2d2d2 !important","border-radius":"0"},attrs:{height:"70px",flat:""}},[t.loading?t._e():r("v-card-text",[r("p",{staticClass:"subtitle-1 black--text py-0 my-0 font-weight-bold"},[t._v(" "+t._s(t.getThreadUser()?t.getThreadUser().name:"")+" ")]),r("p",{staticClass:"caption"},[t._v("Response Time: 1 day")])]),r("div",{staticClass:"pa-4"},[t.loading?r("v-progress-circular",{staticClass:"mx-auto",attrs:{indeterminate:"",size:"32",color:"success",loading:!0}}):t._e()],1)],1)],1),r("v-row",{staticClass:"pb-4",attrs:{id:"messages-container",align:"end"}},[t.loading?r("div",{staticClass:"d-flex justify-center my-2 pa-12 ma-0",staticStyle:{width:"100%"}},[r("v-progress-circular",{staticClass:"mx-auto",attrs:{indeterminate:"",size:"56",color:"success",loading:!0}})],1):t._e(),r("v-col",[r("v-container",{staticStyle:{"max-width":"700px"}},[t._l(t.sortedMessages,(function(e,a){return r("div",{key:e.id+"_"+t.uuid(),class:["d-flex flex-row align-end my-2",e.user_id==t.currentUser.id?"justify-end":null]},[e.user_id==t.currentUser.id?r("v-card",{staticClass:"black--text mr-3 rounded-lg pa-2",style:t.sortedMessages[a+1]&&t.sortedMessages[a+1].user_id==e.user_id?"":"border-bottom-right-radius: 0px !important",attrs:{"max-width":"500px","min-width":"100px",color:"#4caf50CC",flat:""}},[r("v-card-text",{staticClass:"white--text subtitle-1"},[r("p",[r("span",{staticClass:"subtitle-1 font-weight-bold"},[t._v(t._s(t.currentUser.name))]),r("span",{staticClass:"mx-2"}),r("span",{staticClass:"caption"},[t._v(" "+t._s(t._f("timeFormat")(e.updated_at))+" "),t.isMessageReadByTheParticipant(e.updated_at)?r("v-icon",{staticClass:"mx-2",attrs:{color:"white",size:"20"}},[t._v(" mdi-check-all ")]):t._e()],1)]),t._v(" "+t._s(e.body)+" ")])],1):t._e(),t.sortedMessages[a+1]&&t.sortedMessages[a+1].user_id==e.user_id?r("user-avatar",{staticStyle:{opacity:"0"},attrs:{size:48}}):r("user-avatar",{attrs:{image:t.getParticipantById(e.user_id).avatar,size:48}}),e.user_id!=t.currentUser.id?r("v-card",{staticClass:"black--text ml-3 rounded-lg pa-2",style:t.sortedMessages[a+1]&&t.sortedMessages[a+1].user_id==e.user_id?"":"border-bottom-left-radius: 0px !important",attrs:{"max-width":"500px","min-width":"100px",color:"#2196f3CC",flat:""}},[r("v-card-text",{staticClass:"white--text subtitle-1"},[r("p",[r("span",{staticClass:"subtitle-1 font-weight-bold"},[t._v(t._s(t.getParticipantById(e.user_id).name))]),r("span",{staticClass:"mx-2"}),r("span",{staticClass:"caption"},[t._v(" "+t._s(t._f("timeFormat")(e.updated_at))+" ")])]),t._v(" "+t._s(e.body)+" ")])],1):t._e()],1)})),t._l(t.pendingMessages,(function(e){return r("div",{key:e.body+"_"+t.uuid(),class:["d-flex flex-row align-center my-2 justify-end"]},[r("v-progress-circular",{staticClass:"mx-4",attrs:{color:"success",size:"24",indeterminate:""}}),r("v-card",{staticClass:"black--text mr-3 rounded-xl pa-2",attrs:{"max-width":"500px","min-width":"100px",color:"#4caf5066",flat:""}},[r("v-card-text",{staticClass:"white--text subtitle-1"},[t._v(" "+t._s(e.body)+" ")])],1),r("user-avatar",{attrs:{image:t.currentUser.avatar,size:48}})],1)}))],2)],1)],1),r("div",{staticClass:"message-input-box",staticStyle:{"background-color":"#e4e4e455"}},[r("v-container",{staticClass:"ma-0 pa-0 mx-auto",staticStyle:{"max-width":"700px"}},[r("v-row",{attrs:{"no-gutters":""}},[r("v-col",[r("v-card",{staticStyle:{"background-color":"transparent"},attrs:{flat:""}},[r("v-card-text",[r("v-text-field",{staticStyle:{"background-color":"white"},attrs:{placeholder:"Type Something","append-icon":"mdi-send",outlined:"","hide-details":""},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.send.apply(null,arguments)},"click:append":t.send},model:{value:t.msg,callback:function(e){t.msg=e},expression:"msg"}})],1)],1)],1)],1)],1)],1)],1)],1)},s=[],n=r(62032),i=r(68932),o=r(16198),u=(r(2707),r(9653),r(73210),r(40561),r(35666),r(61747)),c=r(76942),d=r(25934),l=r(30381),p=r.n(l),g=r(80394),f={components:{UserAvatar:c.Z},props:{},data:function(){return{thread:{},pendingMessages:[],loading:!1,msg:null}},updated:function(){this.scrollToEnd()},created:function(){var t=this;return(0,o.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.loadMessages();case 2:g.c.$on("message-for-thread-"+t.thread.id,t.showNewMessage);case 3:case"end":return e.stop()}}),e)})))()},computed:{currentUser:function(){return this.$store.getters["User/user"]},sortedMessages:function(){var t=(0,i.Z)(this.thread.messages||[]);return t.sort((function(t,e){return Number(new Date(t.updated_at))-Number(new Date(e.updated_at))})),t}},methods:{showNewMessage:function(t){var e=(0,i.Z)(this.thread.messages||[]);e.push(t),this.getThreadParticipant().last_read=new Date,this.thread.messages=(0,i.Z)(e)},isMessageReadByTheParticipant:function(t){return p()(t).isBefore(this.getThreadParticipant().last_read)},loadMessages:function(){var t=this;return(0,o.Z)(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.loading=!0,e.next=3,(0,u.Io)(t.$route.params.id);case 3:r=e.sent,t.thread=r.data,t.loading=!1;case 6:case"end":return e.stop()}}),e)})))()},scrollToEnd:function(){var t=this.$el.querySelector("#messages-container"),e=t.scrollHeight;t.scrollTop=e},getParticipantById:function(t){var e,r=(0,n.Z)(this.thread.participants);try{for(r.s();!(e=r.n()).done;){var a=e.value;if(a.user_id==t)return a.user}}catch(s){r.e(s)}finally{r.f()}return null},send:function(){var t=this;return(0,o.Z)(regeneratorRuntime.mark((function e(){var r,a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.msg&&""!=t.msg.trim()){e.next=2;break}return e.abrupt("return",!1);case 2:return r={user_id:t.currentUser.id,body:t.msg},t.msg=null,t.pendingMessages.push(r),e.next=7,(0,u.bG)(t.thread.id,r.body);case 7:a=e.sent,s=Object.assign([],t.thread.messages),s.push(a.data),t.thread.messages=s,t.pendingMessages.splice(t.pendingMessages.indexOf(r),1);case 12:case"end":return e.stop()}}),e)})))()},getThreadUser:function(){return this.getThreadParticipant().user},getThreadParticipant:function(){return this.thread.participants?this.thread.participants[0].user_id==this.currentUser.id?this.thread.participants[1]:this.thread.participants[0]:{}},uuid:function(){return(0,d.Z)()}},watch:{"$route.params.id":function(){this.thread={},this.loadMessages()}}},m=f,h=r(1001),v=r(43453),x=r.n(v),y=r(53237),w=r(37118),_=r(82102),b=r(99846),C=r(96428),k=r(90624),Z=r(62877),R=r(55978),M=(0,h.Z)(m,a,s,!1,null,"67ad5e19",null),T=M.exports;x()(M,{VCard:y.Z,VCardText:w.ZB,VCol:_.Z,VContainer:b.Z,VIcon:C.Z,VProgressCircular:k.Z,VRow:Z.Z,VTextField:R.Z})}}]);
//# sourceMappingURL=messages-thread-legacy.a5176e22.js.map